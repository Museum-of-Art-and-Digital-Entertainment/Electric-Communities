<!--NewPage-->
<html>
<head>
<!-- Generated by javadoc on Sat Apr 05 01:25:52 PST 1997 -->
<a name="_top_"></a>
<title>
  Class ec.e.quake.StableStore
</title>
</head>
<body>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-ec.e.quake.html">This Package</a>  <a href="ec.e.quake.SimplySturdyTether.html#_top_">Previous</a>  <a href="ec.e.quake.Tether.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
  Class ec.e.quake.StableStore
</h1>
<pre>
<a href="java.lang.Object.html#_top_">java.lang.Object</a>
   |
   +----ec.e.quake.StableStore
</pre>
<hr>
<dl>
  <dt> public class <b>StableStore</b>
  <dt> extends <a href="java.lang.Object.html#_top_">Object</a>
</dl>
Reliable storage for an object graph.  A restore() must revive the
last successful save().  If we crash in the middle of a save(),
restore() must revive from the previous one.
This class is CREW!  The TimeMachine is its STEWARD.  Originally
StableStore was defined as a GUEST, until I tried to write the code
to revive from a checkpoint.  Then I realized there wasn't a Vat
for the StableStore to live in.  Since StableStore is useful for
more than just checkpointing, we should give it a more generic
Steward.  <p>
<hr>
<a name="index"></a>
<h2>
  <img src="images/constructor-index.gif" width=275 height=38 alt="Constructor Index">
</h2>
<dl>
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#StableStore(ec.e.quake.File)"><b>StableStore</b></a>(File)
  <dd> Defaults to an OpenerRecipe suitable for persistence

  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#StableStore(ec.e.quake.File, ec.e.openers.OpenerRecipe)"><b>StableStore</b></a>(File, OpenerRecipe)
  <dd> Returns a StableStore for saving and restoring object graphs
to/from the designated place.
</dl>
<h2>
  <img src="images/method-index.gif" width=207 height=38 alt="Method Index">
</h2>
<dl>
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#delete()"><b>delete</b></a>()
  <dd> Cause there to no longer be a valid checkpoint.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#exists()"><b>exists</b></a>()
  <dd> Is there already a checkpoint at this place?

  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#restore()"><b>restore</b></a>()
  <dd> Read in the last successfully saved checkpoint, and return the
resulting object graph.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#save(java.lang.Object)"><b>save</b></a>(Object)
  <dd> Save the object graph rooted in 'root' to the checkpoint.
</dl>
<a name="constructors"></a>
<h2>
  <img src="images/constructors.gif" width=231 height=38 alt="Constructors">
</h2>
<a name="StableStore"></a>
<a name="StableStore(ec.e.quake.File, ec.e.openers.OpenerRecipe)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>StableStore</b>
<pre>
  public StableStore(<a href="ec.e.quake.File.html#_top_">File</a> place,
                     <a href="ec.e.openers.OpenerRecipe.html#_top_">OpenerRecipe</a> maker) throws <a href="java.io.IOException.html#_top_">IOException</a>
</pre>
<dl>
  <dd> Returns a StableStore for saving and restoring object graphs
to/from the designated place.
  <dl>
    <dt> <b>Parameters:</b>
    <dd> place - Provides the stable store the ability to read and
write files within a particular directory.  StableStore uses
specific filenames within this directory.
    <dd> maker - Provides the StableStore with the ability to "peer
into" objects, and a "point-of-view" about their contents (eg,
do transient instance variables exist?  Should a Hastable be
seen as consisting only of corresponding key & value object, to
be rehashed on decoding?)
  </dl>
</dl>
<a name="StableStore(ec.e.quake.File)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>StableStore</b>
<pre>
  public StableStore(<a href="ec.e.quake.File.html#_top_">File</a> place)
</pre>
<dl>
  <dd> Defaults to an OpenerRecipe suitable for persistence
</dl>
<a name="methods"></a>
<h2>
  <img src="images/methods.gif" width=151 height=38 alt="Methods">
</h2>
<a name="exists()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="exists"><b>exists</b></a>
<pre>
  public boolean exists() throws <a href="java.io.IOException.html#_top_">IOException</a>
</pre>
<dl>
  <dd> Is there already a checkpoint at this place?
</dl>
<a name="save(java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="save"><b>save</b></a>
<pre>
  public void save(<a href="java.lang.Object.html#_top_">Object</a> root) throws <a href="java.io.IOException.html#_top_">IOException</a>
</pre>
<dl>
  <dd> Save the object graph rooted in 'root' to the checkpoint.
Don't return until it is reliably committed.  If there is
already a valid checkpoint there, all failure conditions that
preserve the following properties should leave a valid
checkpoint behind. <p> 
XXX Assumptions made in the current implementation: 
<pre>
    1) flush() or close() reliably commits to disk.
    2) rename is atomic and reliable, and so doesn't copy
    3) no one else is concurrently using this directory
    4) closes & renames happen in the order issued
</pre>
The code assume that a rename to an existing filename will
wipe out the destination file as part of the one atomic
action.  Under no conditions will it wipe out the destination
but not rename the source. <p>
Properties #1 may already be implemented by java.io, we need to
find out.  Property #3 we know to not be assured by any
software, and doing so in a portable fashion looks hard. <p>
I expect #4 is given by most operating systems as well as
Microsoft Windows. <p>
</dl>
<a name="restore()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="restore"><b>restore</b></a>
<pre>
  public <a href="java.lang.Object.html#_top_">Object</a> restore() throws <a href="java.io.IOException.html#_top_">IOException</a>
</pre>
<dl>
  <dd> Read in the last successfully saved checkpoint, and return the
resulting object graph.
</dl>
<a name="delete()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="delete"><b>delete</b></a>
<pre>
  public void delete() throws <a href="java.io.IOException.html#_top_">IOException</a>
</pre>
<dl>
  <dd> Cause there to no longer be a valid checkpoint.  After this
operation completes, restore()s will fail until there is
another save().
</dl>
<hr>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-ec.e.quake.html">This Package</a>  <a href="ec.e.quake.SimplySturdyTether.html#_top_">Previous</a>  <a href="ec.e.quake.Tether.html#_top_">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
