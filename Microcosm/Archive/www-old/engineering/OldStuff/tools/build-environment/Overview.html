<HTML>
<HEAD>
    <TITLE>Build Environment Overview</TITLE>
</HEAD>
<BODY>

<H1>Build Environment Overview</H1>

<em>This page is maintained by <A HREF="mailto:trev@communities.com">Trev</A>.
Please let me know of any errors ASAP so I can fix them.
<br>
<b>Warning:</b> these pages change frequently. If you've looked at them
recently hit "reload" on your browser to make sure you're seeing the
latest version.
</em>
<p>
This page gives an overview of the build environment, the directory
structure it sets up on your disk and the common <code>make</code>
targets.

<h2>Aims Of The Build Environment</h2>

The HabiFoo application, together with E, Pluribus and various
supporting libraries, make up a very complex system. Few people,
if any, understand all the different parts of the system, or even
what all the parts are and how they fit together.
<p>
The first aim of the build environment - a collection of tools and
makefiles - is to provide a simple way to build and run this complex
system. In our previous build environment few people new how to build
a system from scratch (e.g. how to build ecomp and then build with
that ecomp) and fewer still knew how to produce a release, with
all the necessary files packaged in a single directory. The new build
environment allows anyone to do both.
<p>
A second important aim of the build environment is to separate sources
and generated files. All sources are under CVS control. No generated
files are (with an exception that we'll see later). This means that we
can reproduce any release from the CVS history because everything that
went into producing that release is under CVS control.
<p>
Note that the definition of <em>source</em> is anything that is input
to the build process (i.e. isn't generated by the build process). Our
Java, E and Pluribus sources are an obvious example. But we also
include media (realm text files, images) and third party software
(java, the AnyChannel renderer) in this category. They are all needed
to reproduce a release.
<p>
Some things that might seem like source aren't. For example the unit
files produced by the Pluribus compiler are text files and are, in
some sense, E source. But to the build environment they are generated
files; they are derived from the Pluribus source and do not need to
be under CVS control.

<h2>The Directory Structure</h2>

The build environment uses the following directory structure
<dl>

<dt><code>\EC</code>

<dd>This directory contains the build environment tools (cvs, 4NT,
bash, the GNU tools, the Java compiler etc.) plus other libraries and
support files needed to build the system (e.g. environment bat files,
Java standard classes, the AnyChannel renderer). It has two important
subdirectories, described below.

<dt><code>\EC\TP</code>

<dd>TP stands for <em>Third Party</em>. This subdirectory of
<code>\EC</code> contains third party software that we rely on and
that needs to be shipped with our release e.g. Java, the AnyChannel
renderer, VoxWare. It does not include third party tools such as
<code>make</code> which we use when we build but don't ship in a
release. Third party software in this directory should be organized in
subdirectories and must be marked with a version number (e.g.
<code>java-1.1.3</code>). The version number is important so that we
can reconstruct specific releases; e.g. if Microcosm version X was
constructed with Java version 1.1.3 we need that to be explicit in the
checked in environment files that correspond to Microcosm version X.

<dt><code>\EC\FP</code>

<dd>FP stands for <em>First Party</em>. This subdirectory contains
pre-built version of our own software e.g. the E and Pluribus
compilers, the E and Pluribus runtime, the HabiFoo classes and their
supporting libraries. These files are the one exception to the "no
generated files under CVS" rule. They are kept in <code>\EC</code> as
a convenience for developers who want to build just the part of the
system they've changed, not the entire tree. For example, developers
who never work outside of HabiFoo can just build HabiFoo and use the E
and Pluribus that come in <code>\EC\FP</code>.

<dt><code>\src</code>

<dd>This directory contains the Java, C/C++, E and Pluribus sources
for E, Pluribus and HabiFoo. E, Pluribus and some support libraries
are in subdirectory <code>\src\ec3</code>. The HabiFoo application is
in subdirectory <code>\src\cosm1</code>. There are some scripts and
supporting files (e.g. prop files) to do with running HabiFoo in
<code>\src\cosm1\start</code>.

<dt><code>\media</code>

<dd>This directory contains all the artwork, realm and catalog files
used by the HabiFoo application. Much of the artwork is bundled up
into a repository before it is used by HabiFoo - but the repository
is a generated file so it is not checked in.

<dt><code>\Build</code>

<dd>This directory is used to store generated files during the build
process. It also has a special subdirectory, <code>\Build\Release</code>,
which is described below. Note that generated files should always end
up somewhere in <code>\Build</code>. Conversely <code>\Build</code> does
not contain any source files (though it may contain copies of source
files, generated during the build process). <code>\Build</code> is
<em>not</em> under CVS control and can be safely deleted (in fact
it's common practice to delete <code>\Build</code> when rebuilding
from scratch).

<dt><code>\Build\Release</code>

<dd>This directory contains only the files needed in a standalone
release of Microcosm. Extra work may be needed to get this directory
fully populated. For example, during a build class files may be
generated into, say, <code>\Build\steward\classes</code>. But they are
not put into <code>\Build\Release</code>. There is a separate build
step to zip up all the classes needed a release and put them in one
big zipfile in <code>\Build\Release</code>.
<p>
There are a couple of reasons for this two stage process. Firstly,
there are many temporary files generated during a build and it doesn't
make sense to put them in <code>\Build\Release</code>, where they
would clutter up the release. Secondly, developers don't need a self
contained release at all times. They have the build environment
installed and the extra effort of zipping and copying everything into
<code>\Build\Release</code> would be a waste when they can just pick
things up from <code>\EC</code>. However, if a developer hands off a
release to someone else they should first do the extra work to set up
<code>\Build\Release</code> properly (see <A
href="BuildRelease.html">Building a Release</a> for more details).

</dl>


<h2>Common <code>make</code> Targets</h2>

When rebuilding the system, you should usually build in
<code>\src</code>. The top level makefile in <code>\src</code> has
many useful targets. You can get a list of these targets by going into
<code>\src</code> and typing <code>make</code>. You'll get the
following message:

<blockquote><code>
Please specify a set of make targets.  Select no more than one per category.<br>
<br>
   'everything'       : build all sources<br>
   'cosm'             : just perform a build in cosm1<br>
   'objects'          : just perform a build in cosm1/objects<br>
   'nobuild'          : do not build<br>
   'firstparty'       : build all sources and populate /Build/FP<br>
    (firstparty builds must be done within a release environment)<br>
<br>
   'release'          : Populate /Build/Release with HabiTurf items<br>
   'hub-release'      : release + add hub-related items to /Build/Release<br>
<br>
   'ec-zipclasses'    : Create zipfile from classes in /EC<br>
   'build-zipclasses' : Create zipfile from classes in /Build and /EC/TP<br>
   'zipclasses'       : Create zipfile from classes in /EC/TP, EC/FP & /Build<br>
<br>
   'makerep'          : make a repository<br>
   'getrep'           : get repository from /home/eng/media<br>
   'norep'            : don't get or create a repository<br>
<br>
Examples:<br>
<br>
    Typical:  make nobuild release getrep<br>
    Full:     make everything hub-release build-zipclasses makerep<br>
</code></blockquote>

<p>
<A href="index.html">Back to the index</a>
</BODY>
</HTML>
