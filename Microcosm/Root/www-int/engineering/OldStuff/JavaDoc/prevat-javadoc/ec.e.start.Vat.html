<!--NewPage-->
<html>
<head>
<!-- Generated by javadoc on Wed Apr 16 18:47:54 PDT 1997 -->
<a name="_top_"></a>
<title>
  Class ec.e.start.Vat
</title>
</head>
<body>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-ec.e.start.html">This Package</a>  <a href="ec.e.start.TimeQuake.html#_top_">Previous</a>  <a href="Package-ec.e.start.html">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
  Class ec.e.start.Vat
</h1>
<pre>
<a href="java.lang.Object.html#_top_">java.lang.Object</a>
   |
   +----ec.e.start.Vat
</pre>
<hr>
<dl>
  <dt> public class <b>Vat</b>
  <dt> extends <a href="java.lang.Object.html#_top_">Object</a>
</dl>
The holder for an ERunQ and a set of guest & steward objects, all
of which get saved and restored as a unit.  The vat itself is the
root object for externalizing/internalizing from a checkpoint file.
The objects "in" the vat are those that are e-reachable starting
from roots & terminating at leafs.  <p>
Unlike Leafs, roots are not Tethers.  Rather, roots are the objects
designated by root holders, which are Tethers.  Fragile roots are
objects designated by FragileRootHolders, and must also be
Seismologists. <p>
Fragile roots are registered with the Vat so long as their
FragileRootHolder continues to exist and no quake occurs.  Should
the FragileRootHolder get collected, the fragile root is simply
unregistered so it may be collected as well.  Should a quake occur,
all the fragile roots are notified and unregistered. <p>
The vat is callable by multiple threads, both from within and
without the vat.  But only very carefully!  (XXX need to be more
explicit here.)
<hr>
<a name="index"></a>
<h2>
  <img src="images/constructor-index.gif" width=275 height=38 alt="Constructor Index">
</h2>
<dl>
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#Vat(java.util.Properties)"><b>Vat</b></a>(Properties)
  <dd> Returns a new vat

</dl>
<h2>
  <img src="images/method-index.gif" width=207 height=38 alt="Method Index">
</h2>
<dl>
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#lastQuake()"><b>lastQuake</b></a>()
  <dd> A description of the last quake experienced by this vat.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#makeFragileRoot(java.lang.Object, ec.e.start.Seismologist)"><b>makeFragileRoot</b></a>(Object, Seismologist)
  <dd> Registers the in-vat seismologist, and returns the out-of-vat
Tether that retains 'held'.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#makeFragileRoot(ec.e.start.Seismologist)"><b>makeFragileRoot</b></a>(Seismologist)
  <dd> Equivalent to 'makeFragileRoot(waiting, waiting)', for when the
object held by the Tether is the same as the Seismologist
wanting to know that a quake has happened.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#quakeCount()"><b>quakeCount</b></a>()
  <dd> How many quakes has this vat experienced?

  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#report(int)"><b>report</b></a>(int)
  <dd> Tells the vat that a quake happened, and what kind of damage
occurred.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#revive(java.lang.String[], java.util.Properties, java.lang.Object)"><b>revive</b></a>(String[], Properties, Object)
  <dd> Post-quake initialization.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#setWaiter(ec.e.start.Seismologist)"><b>setWaiter</b></a>(Seismologist)
  <dd> Used by the TimeMachine to ensure that a commit is confirmed in
the revived world.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#vatLock()"><b>vatLock</b></a>()
  <dd> 
This is the one and only lock for synchronizing between the
vat and the outside world.
</dl>
<a name="constructors"></a>
<h2>
  <img src="images/constructors.gif" width=231 height=38 alt="Constructors">
</h2>
<a name="Vat"></a>
<a name="Vat(java.util.Properties)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>Vat</b>
<pre>
  public Vat(<a href="java.util.Properties.html#_top_">Properties</a> props) throws <a href="ec.e.start.OnceOnlyException.html#_top_">OnceOnlyException</a>, <a href="java.io.IOException.html#_top_">IOException</a>
</pre>
<dl>
  <dd> Returns a new vat
</dl>
<a name="methods"></a>
<h2>
  <img src="images/methods.gif" width=151 height=38 alt="Methods">
</h2>
<a name="vatLock()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="vatLock"><b>vatLock</b></a>
<pre>
  public <a href="java.lang.Object.html#_top_">Object</a> vatLock()
</pre>
<dl>
  <dd> This is the one and only lock for synchronizing between the
vat and the outside world.  This is only yielded by the ERunQ
at bracepoints.
</dl>
<a name="setWaiter(ec.e.start.Seismologist)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="setWaiter"><b>setWaiter</b></a>
<pre>
  public void setWaiter(<a href="ec.e.start.Seismologist.html#_top_">Seismologist</a> waiter)
</pre>
<dl>
  <dd> Used by the TimeMachine to ensure that a commit is confirmed in
the revived world.
  <dl>
    <dt> <b>Parameters:</b>
    <dd> waiter - suspect, nullOk;
  </dl>
</dl>
<a name="revive(java.lang.String[], java.util.Properties, java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="revive"><b>revive</b></a>
<pre>
  public void revive(<a href="java.lang.String.html#_top_">String</a> args[],
                     <a href="java.util.Properties.html#_top_">Properties</a> props,
                     <a href="java.lang.Object.html#_top_">Object</a> checkpoint) throws <a href="ec.e.start.OnceOnlyException.html#_top_">OnceOnlyException</a>
</pre>
<dl>
  <dd> Post-quake initialization.  Report a Reincarnation quake and
tell myWaiter, if any, to notice a commit.  This method will
restart the ERunQ thread. <p>
(If there could be multiple ERunQs, we'd need to be careful
that the deliveries scheduled by this method are in the ERunQ
of the revived vat.) <p>
  <dl>
    <dt> <b>Parameters:</b>
    <dd> args - revival command line args (after properties are
stripped off)
    <dd> props - properties specified by the revival command line
    <dd> checkpoint - the new value for the special magic power
named "CheckpointTether", and used by the TimeMachine.  XXX
This is typed as 'Object' to avoid having this module depend on     
ec.e.quake.
  </dl>
</dl>
<a name="makeFragileRoot(java.lang.Object, ec.e.start.Seismologist)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="makeFragileRoot"><b>makeFragileRoot</b></a>
<pre>
  public <a href="ec.e.start.FragileRootHolder.html#_top_">FragileRootHolder</a> makeFragileRoot(<a href="java.lang.Object.html#_top_">Object</a> held,
                                           <a href="ec.e.start.Seismologist.html#_top_">Seismologist</a> waiting)
</pre>
<dl>
  <dd> Registers the in-vat seismologist, and returns the out-of-vat
Tether that retains 'held'.  This is typically used for the
return path of an asynchronous call from in-vat to out-of-vat.
The out-of-vat activity would reply to the 'held' when
complete (after narrowing it to something else, of course), but
in the meantime, the Seismologist would still be considered
reachable for persistence.  Should a quake occur before
the operation completes, the Seismologist (if non-null) is
notified instead.  Were we also doing reachability for egc
(which the prevat does not do, but the EVat will), then both
'held' and 'waiting' would be reachable for egc purposes.
  <dl>
    <dt> <b>Parameters:</b>
    <dd> held - suspect nullOk
    <dd> waiting - suspect nullOk
  </dl>
</dl>
<a name="makeFragileRoot(ec.e.start.Seismologist)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="makeFragileRoot"><b>makeFragileRoot</b></a>
<pre>
  public <a href="ec.e.start.FragileRootHolder.html#_top_">FragileRootHolder</a> makeFragileRoot(<a href="ec.e.start.Seismologist.html#_top_">Seismologist</a> waiting)
</pre>
<dl>
  <dd> Equivalent to 'makeFragileRoot(waiting, waiting)', for when the
object held by the Tether is the same as the Seismologist
wanting to know that a quake has happened.
  <dl>
    <dt> <b>Parameters:</b>
    <dd> waiting - suspect nullOk
  </dl>
</dl>
<a name="quakeCount()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="quakeCount"><b>quakeCount</b></a>
<pre>
  public long quakeCount()
</pre>
<dl>
  <dd> How many quakes has this vat experienced?
</dl>
<a name="lastQuake()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="lastQuake"><b>lastQuake</b></a>
<pre>
  public <a href="ec.e.start.TimeQuake.html#_top_">TimeQuake</a> lastQuake()
</pre>
<dl>
  <dd> A description of the last quake experienced by this vat.
</dl>
<a name="report(int)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="report"><b>report</b></a>
<pre>
  public void report(int damage)
</pre>
<dl>
  <dd> Tells the vat that a quake happened, and what kind of damage
occurred.  The vat updates its lastQuake, and causes all
Seismologists waiting for this quake to notice it, including
all fragile roots.
</dl>
<hr>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-ec.e.start.html">This Package</a>  <a href="ec.e.start.TimeQuake.html#_top_">Previous</a>  <a href="Package-ec.e.start.html">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
