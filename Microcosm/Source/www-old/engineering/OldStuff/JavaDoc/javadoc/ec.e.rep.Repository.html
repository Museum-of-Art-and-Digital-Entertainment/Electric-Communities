<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<!--NewPage-->
<html>
<head>
<!-- Generated by javadoc on Thu Jul 24 15:45:43 PDT 1997 -->
<title>
  Class ec.e.rep.Repository
</title>
</head>
<body>
<a name="_top_"></a>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-ec.e.rep.html">This Package</a>  <a href="Package-ec.e.rep.html">Previous</a>  <a href="Package-ec.e.rep.html">Next</a>  <a href="AllNames.html">Index</a></pre>
<hr>
<h1>
  Class ec.e.rep.Repository
</h1>
<pre>
java.lang.Object
   |
   +----ec.e.rep.Repository
</pre>
<hr>
<dl>
  <dt> public class <b>Repository</b>
  <dt> extends Object
  <dt> implements <a href="ec.e.rep.steward.SimpleRepository.html#_top_">SimpleRepository</a>
</dl>
A Repository is a subsystem that manages access to a small
 number of data files known as RepositoryFiles. Each Repository
 can thus have several files, and each running system may use
 several Repositories implementing different policies. <p>
 The most common policy is to use Repositories as a permanent
 storage and distribution medium. As an example, a virtual world
 could be distributed on a CD-ROM, and parts of the data in the
 world could be kept in a Repository file on the CD-ROM. (The
 other main part in a CD-ROM distribution would be a persistent
 checkpoint image file) <p>
 A variant of this is to use RepositoryFiles as download units
 for medium-size packages of data such as realms created by
 third parties. A user could download a RepositoryFile over the
 web and by simply placing it into the appropriate directory the
 data in it would become available to a Repository that manages
 import of such modules to the running system. These files could
 be used to distribute patches, to speed up access to entire
 turfs, and (later) to add new functionality to the system. <p>
 Yeta nother variation is to use a Repository to implement a
 network cache, storing downloaded objects in case they are
 needed again. These caches are pruned on an Least-Recently-Used
 basis by discarding old repositoryfiles, after all recently
 referenced objects have been copied to later-generation
 repositoryfiles. This is (or will be) implemented in
 CacheRepository.java <p>
 We may or may not use a repository to store Certificates. This
 Repository would grow as new Certificates were automatically
 added by downloading them but would not delete them like a
 Cache would.<p>
 A running system could thus have several different
 repositories, each implementing one of these roles. It is
 necessary to keep these as separate Repositories since the
 policies don't mix. <p>
 Each Repository has one or more RepositoryFiles associated with
 it.  These RepositoryFiles form a searchpath.  Only the first
 RepositoryFile can be (but need not be) opened for write
 acccess. <p>
 A record in a repository will override the records in
 Repositories behind it. As a special case, a record with a
 valid key but a zero-length value will pretend to be
 "nonexistent", possibly overriding real values in
 RepositoryFiles behind it. This is necessary since there would
 otherwise be no way to delete values found in files late in the
 RepositoryFile chain.<p>
 Two common patterns receive extra support: Opening all files in
 a directory as a single repository, sorting them by filename -
 This is used to collect add-on feature, patch, and speedup
 files; and opening all files in a directory by filename, adding
 one writable file with a name "beyond" the last-sorting such
 filename. This is used to support cache directories - look for
 this in CacheRepository.java.
 All rights to a repository are defined to be equal to the
 rights you have to the repository directory itself and the
 files therein and (if applicable) to the explicitly specified
 firstFile. <p>
<p>
<hr>
<a name="index"></a>
<h2>
  <img src="images/constructor-index.gif" width=275 height=38 alt="Constructor Index">
</h2>
<dl>
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#Repository(ec.e.file.EDirectoryBase, ec.e.file.EEditableFile)"><b>Repository</b></a>(EDirectoryBase, EEditableFile)
  <dd> 

 Constructor to create a Repository given a directory and
 (optionally) a distinguished, possibly writable file.
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#Repository(ec.e.file.EEditableFile)"><b>Repository</b></a>(EEditableFile)
  <dd> 

 Constructor to create a Repository given an EEditableFile.
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#Repository(ec.e.file.EFileReader)"><b>Repository</b></a>(EFileReader)
  <dd> 

 Constructor to create a Repository given a an EFileEditor or
 EFileReader.
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#Repository(ec.e.file.EReadableFile)"><b>Repository</b></a>(EReadableFile)
  <dd> 

 Constructor to create a Repository given an EReadableFile.
  <dt> <img src="images/yellow-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#Repository(java.util.Vector)"><b>Repository</b></a>(Vector)
  <dd> 
 Constructor to create a Repository given a vector of
 files.
</dl>
<h2>
  <img src="images/method-index.gif" width=207 height=38 alt="Method Index">
</h2>
<dl>
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#analyzeFiles()"><b>analyzeFiles</b></a>()
  <dd> 
 Analyze all repositoryfiles to ensure they are
 consistent.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#close()"><b>close</b></a>()
  <dd> 
 Close the Repository.
  <dt> <img src="images/green-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#computeCryptoHash(java.lang.Object)"><b>computeCryptoHash</b></a>(Object)
  <dd> 
 Compute a cryptohash for an object using our all-powerful
 RootClassRecipe Opener Recipe.
  <dt> <img src="images/green-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#computeCryptoHash(java.lang.Object, ec.e.openers.OpenerRecipe)"><b>computeCryptoHash</b></a>(Object, OpenerRecipe)
  <dd> 
 Compute a cryptohash for a given object using the given
 OpenerRecipe.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#delete(java.lang.Object)"><b>delete</b></a>(Object)
  <dd> 
 Deletes a record (key and its value) from the Repository.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#exists(java.lang.Object)"><b>exists</b></a>(Object)
  <dd> 
 Determine whether an object with a given key exists in the
 Repository.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#get(java.lang.Object)"><b>get</b></a>(Object)
  <dd> 
 Simplest way to retrieve an object stored under a given
 key.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#get(java.lang.Object, ec.e.rep.RtDecodingParameters)"><b>get</b></a>(Object, RtDecodingParameters)
  <dd> 
 Retrieve an object stored under a given key.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#isWritable()"><b>isWritable</b></a>()
  <dd> 
 A Writability predicate.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#keys()"><b>keys</b></a>()
  <dd> 

 Returns an enumerator to access all records by key, for
 debugging purposes.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#put(java.lang.Object, java.lang.Object)"><b>put</b></a>(Object, Object)
  <dd> 
 Simplest way to store an object in the Repository using a
 specific key.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#putHash(java.lang.Object)"><b>putHash</b></a>(Object)
  <dd> 
 Stores an object into the Repository using the cryptohash of
 the data as a key.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#repairFiles(boolean)"><b>repairFiles</b></a>(boolean)
  <dd> 
 Attempt to repair damage in all repositoryfiles.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#size()"><b>size</b></a>()
  <dd> 
 Return the total number of records in this entire
 repository.
  <dt> <img src="images/red-ball-small.gif" width=6 height=6 alt=" o ">
	<a href="#size(java.lang.Object)"><b>size</b></a>(Object)
  <dd> 
 Reports on the size of the data for the given key.
</dl>
<a name="constructors"></a>
<h2>
  <img src="images/constructors.gif" width=231 height=38 alt="Constructors">
</h2>
<a name="Repository"></a>
<a name="Repository(ec.e.file.EDirectoryBase, ec.e.file.EEditableFile)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>Repository</b>
<pre>
 public Repository(EDirectoryBase repositoryDir,
                   EEditableFile firstFile) throws <a href="ec.e.rep.steward.RepositoryAccessException.html#_top_">RepositoryAccessException</a>, IOException
</pre>
<dl>
  <dd> Constructor to create a Repository given a directory and
 (optionally) a distinguished, possibly writable file. <p>
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> repositoryDir - notNull - an EDirectoryBase. Could be (and
 most often is) an EEditableDirectory.
    <dd> firstFile - nullOK - an EEditableFile. If given, and if
 writable, then this file is opened as a writable RepositoryFile
 and becomes the frontmost file in this repository. <p>
 If the firstFile cannot be opened as a writable file, then it
 <b>still</b> becomes the first file but it is opened
 read-only. <p>
 All other RepositoryFiles in the directory are opened and added
 to the set of searched files in reverse order by name - files
 with names that sort first are searched last. This is
 consistent with CacheRepository files which are named in
 chronological order, since we want the latest files to be
 searched first. All files in the vector are opened for
 read-only access, except if there is a duplicate entry of
 firstFile, in which case it will not be opened a second time.
  </dl></dd>
</dl>
<a name="Repository(ec.e.file.EEditableFile)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>Repository</b>
<pre>
 public Repository(EEditableFile file) throws IOException
</pre>
<dl>
  <dd> Constructor to create a Repository given an EEditableFile.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> file - notNull - an EEditableFile. This Repository will be
 writable.
  </dl></dd>
</dl>
<a name="Repository(ec.e.file.EReadableFile)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>Repository</b>
<pre>
 public Repository(EReadableFile file) throws IOException
</pre>
<dl>
  <dd> Constructor to create a Repository given an EReadableFile.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> file - notNull - an EReadableFile. This repository will be read-only.
  </dl></dd>
</dl>
<a name="Repository(ec.e.file.EFileReader)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>Repository</b>
<pre>
 public Repository(EFileReader reader) throws IOException
</pre>
<dl>
  <dd> Constructor to create a Repository given a an EFileEditor or
 EFileReader. <p>
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> reader - notNull - an EFileReader. Could be a EFileEditor, in
 which case this Repository is writable.
  </dl></dd>
</dl>
<a name="Repository(java.util.Vector)"><img src="images/yellow-ball.gif" width=12 height=12 alt=" o "></a>
<b>Repository</b>
<pre>
 public Repository(Vector files) throws IOException
</pre>
<dl>
  <dd> Constructor to create a Repository given a vector of
 files.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> files - - a vector of EDirectoryElement's.  All files are
 opened for read access only, whether or not they are instances
 of EEditableFile. Directories in the vector are ignored. Other
 items will throw an IOException.
  </dl></dd>
</dl>
<a name="methods"></a>
<h2>
  <img src="images/methods.gif" width=151 height=38 alt="Methods">
</h2>
<a name="close()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="close"><b>close</b></a>
<pre>
 public void close() throws IOException
</pre>
<dl>
  <dd> Close the Repository. Closes all of its RepositoryFiles. You
 cannot use the repository after you close it.
<p>
</dl>
<a name="isWritable()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="isWritable"><b>isWritable</b></a>
<pre>
 public boolean isWritable()
</pre>
<dl>
  <dd> A Writability predicate.
<p>
</dl>
<a name="put(java.lang.Object, java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="put"><b>put</b></a>
<pre>
 public void put(Object key,
                 Object object) throws <a href="ec.e.rep.steward.RepositoryAccessException.html#_top_">RepositoryAccessException</a>
</pre>
<dl>
  <dd> Simplest way to store an object in the Repository using a
 specific key. It will throw an RepositoryAccessException if the
 frontMost RepositoryFile is not writable.
<p>
</dl>
<a name="putHash(java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="putHash"><b>putHash</b></a>
<pre>
 public CryptoHash putHash(Object object) throws <a href="ec.e.rep.steward.RepositoryAccessException.html#_top_">RepositoryAccessException</a>
</pre>
<dl>
  <dd> Stores an object into the Repository using the cryptohash of
 the data as a key.  It returns that key, an instance of
 CryptoHash. It will throw a RepositoryAccessException if the
 Repository is not writable.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> object - The object to save in the Repository using an
 automatically generated key.
    <dt> <b>Returns:</b>
    <dd> The generated hash key used (an instance of class CryptoHash).
  </dl></dd>
</dl>
<a name="exists(java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="exists"><b>exists</b></a>
<pre>
 public boolean exists(Object key)
</pre>
<dl>
  <dd> Determine whether an object with a given key exists in the
 Repository.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> key - A key to search for, any non-null object but most
 often a String or cryptohash object.
    <dt> <b>Returns:</b>
    <dd> true if record exists and false otherwise<p>
  </dl></dd>
</dl>
<a name="size(java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="size"><b>size</b></a>
<pre>
 public int size(Object key)
</pre>
<dl>
  <dd> Reports on the size of the data for the given key.
 If any error occurs, returns -1.
<p>
</dl>
<a name="get(java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="get"><b>get</b></a>
<pre>
 public Object get(Object key)
</pre>
<dl>
  <dd> Simplest way to retrieve an object stored under a given
 key. Returns null if the key could not be found in any
 of our RepositoryFiles, or if the found object could not be
 completely decoded for any reason. If you want to know what went
 wrong, use another get() method.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> key - notNull - A key to search for, any non-null object
 but most often a String or cryptohash object.
    <dt> <b>Returns:</b>
    <dd> The retrieved object, or null.
  </dl></dd>
</dl>
<a name="get(java.lang.Object, ec.e.rep.RtDecodingParameters)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="get"><b>get</b></a>
<pre>
 public Object get(Object key,
                   <a href="ec.e.rep.RtDecodingParameters.html#_top_">RtDecodingParameters</a> parameters) throws <a href="ec.e.rep.steward.RepositoryAccessException.html#_top_">RepositoryAccessException</a>, <a href="ec.e.rep.steward.RepositoryNeedParameterException.html#_top_">RepositoryNeedParameterException</a>, <a href="ec.e.rep.steward.RepositoryKeyNotFoundException.html#_top_">RepositoryKeyNotFoundException</a>, IOException
</pre>
<dl>
  <dd> Retrieve an object stored under a given key. If found, returns
 the object stored under that key. Throws an exception if the
 key could not be found in any of our RepositoryFiles, or if the
 found object could not be completely decoded for any reason. <p>
 The parameters argument (an RtDecodingParameters collection),
 if given, is used when decoding the object. If the object in
 the Repository requires a parameter token/value pair (to be
 substituted for an object that was pruned when encoding the
 object) but either no parameters collection was given, or it
 does not contain an entry for the parameter, then a
 RepositoryNeedParameterException is thrown. <p>
 If the object could not be decoded for any other reason, then a
 RepositoryAccessException is thrown.
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> key - notNull - A key to search for, any non-null object but most
 often a String.
    <dd> parameters - nullOK - An RtDecodingParameters collection
 of token objects (typically Strings) as keys and Objects as
 values. When decoding the object, any parameter token that is
 encountered in the Repository is looked up in the parameters
 collection and gets replaced with the value found there.<p>
 <p><b>NOTE</b> XXX - we don't currently use the RtDecodingParameters
 argument - it is ignored until our Openers can use it.</b> <p>
    <dt> <b>Returns:</b>
    <dd> The retrieved object. You may need to cast the return
 object to your target data type. Never returns null.
  </dl></dd>
</dl>
<a name="delete(java.lang.Object)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="delete"><b>delete</b></a>
<pre>
 public boolean delete(Object key) throws <a href="ec.e.rep.steward.RepositoryAccessException.html#_top_">RepositoryAccessException</a>
</pre>
<dl>
  <dd> Deletes a record (key and its value) from the Repository.
 Adds a voiding record to frontMostFile if all entries in path
 could not be deleted (since they may be in a read-only
 repository file)
<p>
  <dd><dl>
    <dt> <b>Parameters:</b>
    <dd> key - notNull - A key object identifying the record to be deleted.
    <dt> <b>Returns:</b>
    <dd> true if something was successfully deleted and false
 otherwise.
  </dl></dd>
</dl>
<a name="size()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="size"><b>size</b></a>
<pre>
 public int size()
</pre>
<dl>
  <dd> Return the total number of records in this entire
 repository. This is exactly the number of records in our
 shallow binding key hashtable
<p>
</dl>
<a name="analyzeFiles()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="analyzeFiles"><b>analyzeFiles</b></a>
<pre>
 public void analyzeFiles()
</pre>
<dl>
  <dd> Analyze all repositoryfiles to ensure they are
 consistent. Results are output to EStdIO.err(). Available to
 allow interactive Repository tools to analyze problems. Does
 not modify any files <p>
 We catch all exceptions so we can display results from all
 files in the repository. <p>
<p>
</dl>
<a name="repairFiles(boolean)"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="repairFiles"><b>repairFiles</b></a>
<pre>
 public void repairFiles(boolean report) throws IOException
</pre>
<dl>
  <dd> Attempt to repair damage in all repositoryfiles.  For
 non-writable files we will just update the myKeys hashtable.
 If the file is writable we will also repair the file by
 rewriting the reconstructed keys hashtable to it. <p>
 We catch and save exceptions so that we will at least try to
 repair all files. If one or more exceptions were caught, we
 re-throw the last one when we're done. <p>
<p>
</dl>
<a name="keys()"><img src="images/red-ball.gif" width=12 height=12 alt=" o "></a>
<a name="keys"><b>keys</b></a>
<pre>
 public synchronized Enumeration keys()
</pre>
<dl>
  <dd> Returns an enumerator to access all records by key, for
 debugging purposes. In the future it will either be removed
 using a CPP directive or will require some certain debugging
 capability.
<p>
  <dd><dl>
    <dt> <b>Returns:</b>
    <dd> An enumeration containing all keys in the
 Repository.
  </dl></dd>
</dl>
<a name="computeCryptoHash(java.lang.Object, ec.e.openers.OpenerRecipe)"><img src="images/green-ball.gif" width=12 height=12 alt=" o "></a>
<a name="computeCryptoHash"><b>computeCryptoHash</b></a>
<pre>
 public static CryptoHash computeCryptoHash(Object data,
                                            OpenerRecipe recipe)
</pre>
<dl>
  <dd> Compute a cryptohash for a given object using the given
 OpenerRecipe. The result is an instance of class CryptoHash.
<p>
</dl>
<a name="computeCryptoHash(java.lang.Object)"><img src="images/green-ball.gif" width=12 height=12 alt=" o "></a>
<a name="computeCryptoHash"><b>computeCryptoHash</b></a>
<pre>
 public static CryptoHash computeCryptoHash(Object data)
</pre>
<dl>
  <dd> Compute a cryptohash for an object using our all-powerful
 RootClassRecipe Opener Recipe.  It's OK to have a static
 function do this, since it conveys no authority.
<p>
</dl>
<hr>
<pre>
<a href="packages.html">All Packages</a>  <a href="tree.html">Class Hierarchy</a>  <a href="Package-ec.e.rep.html">This Package</a>  <a href="Package-ec.e.rep.html">Previous</a>  <a href="Package-ec.e.rep.html">Next</a>  <a href="AllNames.html">Index</a></pre>
</body>
</html>
