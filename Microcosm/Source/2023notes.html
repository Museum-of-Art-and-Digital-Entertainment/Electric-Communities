<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="Author" CONTENT="Alan Walendowski">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.03 [en] (WinNT; U) [Netscape]">
   <TITLE>2023 Notes - EC Habitats beta r167</TITLE>
</HEAD>
<BODY>

<H1>2023 Notes - EC Habitats beta r167</H1>
<I>Note: 1/12/2024 This page was created by <A HREF="mailto:stuart@renoproject.org">Stuart Cass</A> in 2023 after browsing through the Electric Communities source tree and the r167 client.</I>
<BR> 
<BR>
<h2>Intro</h2>


<P>After speaking with Randy in June 2023 during the initial checkin of Electric Communities assets, he asked that I go through the r167 beta disk to identify services that need to be proxied and which configurations launch which worlds.</p>

<p>I initially filed this as a GitHub issue but have condensed it into one page for the hack day. This initial part provides an overview of what at the time I felt was the most important stuff to know.</p>

<p>The most important things are:</p>

<ul>
 <li>props/default.props</li>
 <li>props/run.props</li>
</ul>

<P>These are the default/normal configuration on the beta disk and will choose your default avatar, realm that you log into, point to the file that I believe is an autogenerated unique identifier used to register you with the EC Habitats member directory and finally, list the URL used to connect to what would've been the LDAP service.</p>

<p>By default, you enter the realm called Change Room (aka the hatchery). This is self contained and has an exit to the Beach Town area, or to your turf if you create one.</p>

<PRE>fiat-lux.communities.com:1670</PRE><p>This was the PLS server which you ran.</p>

<p><a href="http://vega.communities.com/scripts/addavatar.asp">http://vega.communities.com/scripts/addavatar.asp</a> - Called in "props/hubjdbc.props". Seems to register your avatar with a remote members database.</p>

<p><a href="http://elsinore.communities.com/EC-reg/">http://elsinore.communities.com/EC-reg/</a> Unknown what this was for, but it's called in "hubconsole.props". Seems like it's related to a members database.</p>

<p>Something called Receptionist listens on port 49438 when you log in and the client publishes the teleport pads of the Realm you enter as mcm files in your local publishedRefs folder.</p>
 
<BR>
<h2>Notes on the EC Habitats Beta-disk aka build 167</h2>

<P>To manually switch between realms, whilst logged out, modify `props/run.props` and edit the value for `RealmTextFile` to either `realm/realm.ChangeRoom.txt`, `realm/realm.BeachTown.txt` or `realm/realm.TheCity.txt`. Repeat the process by modifying `props/default.props` and modifying the `RealmTextFile` there too.</p>

<h3>Props</h3>

<ul>
	<li>client.props - Unsure what this does.</li>
	<li>console.props - Unsure what this does.</li>
	<li>consolec.props - Unsure what this does.</li>
	<li>default.props - This is the default configuration.</li>
	<li>democd.props - Connects to `realm.Beta.txt` (this realm is missing and inaccessible)</li>
	<li>event.props - Unknown what this does.</li>
	<li>hub.props - Doesn't connect to a world, does something to do with the remote members database.</li>
	<li>hubconsole.props - This doesn't connect to a realm, but seems like it does something with a remote members database.</li>
	<li>hubjdbc.props - This doesn't connect to a realm, but seems like it registers your avatar with a remote members database.</li>
	<li>microcosm.props - Connects to `realm.Preview.txt` (this realm is missing and inaccessible)</li>
	<li>pls_1.mcmav - Seems to be an automatically generated URL to the fiat-lux.communities.com server. I suspect that it's a unique identifier generated at startup time that's used to identify yourself to the EC Habitats member database.</li>
	<li>run.props - This is the default configuration.</li>
	<li>service.props - Unsure what this does, but it looks like it might set environmental variables like `CLASSPATH` and `PATH`. I'm not sure if this gets used as it references `realm.Avatar97.txt` which is not included on the cd and doesn't exist in the source. Seems to allow telnet connections on port 1666 that get hooked to stdin/stdout if you uncomment ListenPort in the file. UPDATE: This appears to be used when starting up your EC Habitats client as a hub rather than as a standard client.</li>
</ul>

<h3>Realms</h3>

<ul>
	<li>BeachTown</li>
	<li>ChangeRoom (Hatchery)</li>
	<li>TheCity</li>
</ul>

<h3>Turf Realms</h3>

<ul>
	<li>Arabian</li>
	<li>Aztec</li>
	<li>Domestic Goddess</li>
	<li>Greek</li>
	<li>Hermit</li>
	<li>Hippy</li>
	<li>Turf Jr</li>
	<li>Turf Jr 2</li>
	<li>Mansion</li>
	<li>Mushroom</li>
	<li>Nouveau</li>
	<li>Simple (Apparently this is a magic simple turf that can be turned into a 2D turf with transparent floor or a 3D-texturized floor. Used for 100% user created turfs. Floor and backdrop are swatachable with anything.)</li>
	<li>Swatchable</li>
	<li>Trailer</li>
	<li>Treehouse</li>
	<li>Victorian</li>
	<li>Warehouse</li>
	<li>Zen</li>
</ul>

<h3>Missing</h3>

<ul>
	<li>Great Round Square (It's linked in the Beach Town realm but inaccessible due to the realm file for GRS being missing. The City realm file mentions GRS was removed at some point)</li>
	<li>realm/realm.Avatar97.txt (Referenced in service.props but missing in source)</li>
	<li>realm.Beta.txt</li>
	<li>realm.Preview.txt</li>
</ul>


<h3>URLs of interest</h3>

<ul>
	<li>fiat-lux.communities.com:1670 (The PLS Server)</li>
	<li><a href="http://vega.communities.com/scripts/addavatar.asp">http://vega.communities.com/scripts/addavatar.asp</a> - Called in "props/hubjdbc.props". Seems to register your avatar with a remote members database.</li>
	<li><a href="http://elsinore.communities.com/EC-reg/">http://elsinore.communities.com/EC-reg/</a> - Unknown what this was for, but it's called in "hubconsole.props". Seems like it's related to a members database.</li>
</ul>

<h3>Misc URLs</h3>

<ul>
	<li><a href="http://www.communities.com/beta">http://www.communities.com/beta</a></li>
	<li><a href="http://www.communities.com/beta/bbs">http://www.communities.com/beta/bbs</a></li>
	<li><a href="http://www.communities.com/entrances">http://www.communities.com/entrances</a> - URL of the Globe in the hatchery, used to connect you to other EC worlds</li>
	<li><a href="http://www.communities.com/directories">http://www.communities.com/directories</a> - Lists all turf directories</li>
	<li><a href="http://www.communities.com/teleportpads/Beach/Beach.mcm">http://www.communities.com/teleportpads/Beach/Beach.mcm</a> - Linked in the hatchery when you mouseover the outside area. Used to connect you to the BeachTown Neighborhood. This file is automatically generated by the client I believe. I was able to have this automatically generated in my PublishedRefs folder after I modified run.props to enter the Beach Town realm by default.</li>
	<li><a href="http://www.communities.com/beach/tos">http://www.communities.com/beach/tos</a> - Beach Town TOS page</li>
	<li><a href="http://www.communities.com/beach/events">http://www.communities.com/beach/events</a> - Beach Town list of current events</li>
	<li><a href="http://www.communities.com/beach/directories">http://www.communities.com/beach/directories</a> - Used to add your home turf to the Beach directory</li>
	<li><a href="http://www.communities.com/city/tos">http://www.communities.com/city/tos</a> - The City TOS</li>
	<li><a href="http://www.communities.com/city/events">http://www.communities.com/city/events</a> - The City events page</li>
	<li><a href="http://www.communities.com/city/directories">http://www.communities.com/city/directories</a> - Used to add your home turf to The City directory</li>
</ul>

<h3>Log output of interest</h3>

<p>This is a session where I logged in as an avatar where my default realm was the BeachTown realm.</p>

<pre>
Receptionist listening on port# 49438
 Publishing Beach's teleport pad as Beach.mcm
 Publishing Mountain Villa's teleport pad as Mountain-Villa.mcm
 Publishing Beach Town Theater's teleport pad as Beach-Town-Theater.mcm
 Publishing Lighthouse's teleport pad as Lighthouse.mcm"
 
ec.e.net.EConnectionRecordException: Connection startup with oaov2rywnl8tx8c44r84of1snugxjq4 encountered the following problems:
fiat-lux.communities.com:1670: java.net.NoRouteToHostException: Operation timed out
null: ec.e.net.EConnectionAttemptFailed: search path exhausted
</pre>

<p>All of the URL's listed above exist in the CVS archive except for <a href="http://elsinore.communities.com/EC-reg/">http://elsinore.communities.com/EC-reg/</a></p>

<h2>Files of interest for the hackday taken from the CVS archive</h2>

<h3>.mcm and .mcmav files</h3>

<ul>
	<li>/www-old/engineering/OldStuff/design_notes/mcm.html - This explains about .mcm and .mcmav files and how to get two EC Habitats clients talking to each other.</li>
</ul>

<p>In order to get two clients talking to each other, one of them needs to know the address of the other one so it can make contact. In the E (language) world, those addresses are known as SturdyRefs and the human readable version of them is called an EARL ("E absolute reference locator").</p>

<p>This means that if you're running a client and you want to enter a region hosted by some server somewhere, you need to supply the SturdyRef of the destination region to your client. You could just type in the EARL (the readable form of the SturdyRef) by hand, but since they're a bit more complex than a typical URL that's fairly inconvenient. For example, an EARL might look like this:</p>

<pre>
e://fiat-lux.communities.com:1670/g326zj926wqigclmgldpaakav6gctlr/wqtd7
</pre>

<h3>Avatar Directory</h3>

<ul>
	<li>/www-old/engineering/OldStuff/neocosm/hub/avatardir.html - This explains how the Avatar Directory works and has some handy diagrams.</li>
</ul>

<p>The avatar directory is a mechanism for hub members to contact other registered members of the hub. Currently, the avatar directory lists "avatars" and the user name associated with that avatar.</p>

<h3>Hub Member Database</h3>

<ul>
	<li>/www-old/engineering/OldStuff/neocosm/hub/mbrdb/hubMbrDB.html - This explains how the Hub Member Database works and has some handy diagrams.</li>
</ul>

<p>The Hub Member DB is a database wrapper which provides high level access to a database schema implemented using an off-the-shelf database product. The highlevel wrapper api provides asynchronous access to the MemberDB schema using E objects, and provides a mechanism for the realm to verify that a given avatar identity exists in the member db, and the identity is allowed to enter the realm. In addition, there is a web based "avatar registration" mechanism for hub users to add their avatars to the member database.</p>

<p>It's been mentioned that to get EC Habitats working again with multiple users, that we'd need to stand up an LDAP server to get things going. Based on reading the notes in the archive, it looks to me like LDAP was used later on once development on EC Habitats had stopped and EC-ID/Palace/etc became the focus instead.</p>

<h2>Relevant stuff from the archives:</h2>

<p>The following sections from now until the end of this document contain snippets from the EC Habitat source that may or not be relevant to our hack day efforts.</p>

<p><i>r167 has a special purpose limited avatar directory using sqlserver</i></p>

<p><i>The current implementation using the SqlServer DB and an ASP is also very much off-the-shelf. Though maybe more lightweight than an LDAP approach, the current approach suffers from not being general enough. E.g., we can't easily use it for Turf Directories.</i></p>

<p><i>The Hub Member DB is a database wrapper which provides high level access to a database schema implemented using an off-the-shelf database product.</i></p>

<p><i>The member db architecture is designed to support multiple underlying database engines. Two are supported: CodeBase (a flat-file xbase compatible db engine on windows) and JDBC. For the JDBC implementation, SqlServer is currently supported, however the JDBC SQL code is generic enough to support other RDBMS. On the JDBC side, the JDK provided JDBC/ODBC bridge is used. Again, other JDBC drivers should work, the only change required is a property that specifies the driver and database URL.</i></p>

<h3>Realm - Member DB - Off the shelf database relationship</h3>

<p>The following diagram shows the components and message flows between the Realm una and the underlying database implementation. (Note: This is a draft picture; there is some simplification.)</p>

<img src="2023_1.png"></img>

<h3>Hub-o-cosm - Habi-cosm - Web - Database relationship</h3>

<p>The other item worth mentioning at this level is the relationship between the hub, habi*, and the web. This is shown in the following diagram.</p>

<img src="2023_2.png"></img>

<h3>Avatar entry dataflow</h3>

<p>The following diagram depicts the process data flow that occurs when an avatar is registered with the MemberDB and tries to enter the world. The Avatar identity is found in the Member DB, and the avatar can enter the world.</p>

<img src="2023_3.png"></img>

<h3>Supported database engines</h3>

<p>Another important aspect of the hub member db is its use of the off-the-shelf database component. The current implementation supports Sequiter CodeBase and MS SqlServer. Other SQL RDBMSs should work; its just a matter of defining the MemberDB schema, and any neccessary stored procedures. The difference between these two DB engines is cost, flexibility, and ease-of-integration. CodeBase is no-royalty and made sense for the "hub" application we were productizing. However, CodeBase is not relational, its difficult to define a multi-table schema, and CodeBase doesn't easily integrate with other web applications. ('C' CGI is the only way to talk to it.) SqlServer carries a hefty price tag, but intregates easily with the java based hub code using JDBC and other web applications. For example, on the MS IIS web server, Active Server Pages directly support Active Data Objects which provide access to ODBC data sources. (Note: CodeBase was the first DB engine to get integrated. Its possible that the higher level implementation has drifted a bit, which require some adjustment to the CodeBase wrapper.)</p>

<h3>Member DB Schema Overview</h3>

<pre>
MS SqlServer DB

* Tables
  * Acct - holds the basic account info: Login, Password, email addr
  * Persons - holds information about the acct holder: Name, real address, phone, etc
  * Identities - avatars that have registered and are members of the hub
  * NewIdentities - a holding area for identities that are attempting to register
  * FailUrls - a small table containing URLs. When an avatar entry fails, one of these URLs is sent back to the user. The failure URL is specified by avatar in the Identities table.
* Unique Keys and Foreign Keys
  * The Acct table specifies an auto generated unique key for each acct record. This key is used as a foreign key in the Persons and Identities tables.
* Relationships
  * Acct -> Persons : One to One
  * Acct -> Identities : One to Many
  * Identities -> FailUrls: Many to One

Which directories on our tree does this subsystem cover?
* src/hub
  * src/hub/dbengines
    * hub/dbengines/jdbc
      * hub/dbengines/jdbc/crew
      * hub/dbengines/jdbc/compute
    * hub/dbengines/xbasedb
      * hub/dbengines/xbasedb/crew
      * hub/dbengines/xbasedb/compute
    * hub/dbengines/testdb
      * hub/dbengines/testdb/crew
   * src/hub/mbrdb
     * hub/mbrdb/crew
     * hub/mbrdb/steward
     * hub/mbrdb/testers
     * hub/mbrdb/compute
     * hub/mbrdb/tools
     * hub/mbrdb/server
</pre>

<h2>Closing</h2>

<p>It also seems like we need to setup a machine as an EC Habitats Hub. This appears to be running a standard EC Habitats client installed to the default location of c:\program files\EC Habitats, then you run `/hubconfig/hubsetup.bat`. There is more configuration involved, but from a guess, it seems to generate a service.props file, starts a service based on one of the pre-existing realm batch files, and generates .mcm files which get uploaded to a web server.</p>

<p>My assumption is that the mcm file generated by the hubsetup batch file would've been the main mcm file on the communities.com server, so for example if you ran the Beach realm hub file, it'd setup a Beach realm instance and you would publish the .mcm file for it to the main site and anyone connecting to it from then on would connect to your hub client.</p>

<p>It appears that you also need to run a PLS server, which can also be found in `/hubconfig/hubsetup.bat` and this is what `fiat-lux.communities.com:1670` was and the main thing the EC Habitats client tries to connect to when clicking on a link to another realm.</p>

<a href="www-old/engineering/OldStuff/index.html">Return to the index</a>

</BODY>
</HTML>
